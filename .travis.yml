language: node_js
cache: yarn

env:
  - CI=true

#branches:
#  only:
#    - develop
#    - /^v\d+\.\d+(\.\d+)?(-\S*)?$/

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.10.1
  - yarn --version
  - wget -qO content.tgz "https://gitlab.com/api/v4/projects/$GAIAMA_CONTENT_ID/repository/archive?sha=$TRAVIS_BRANCH&private_token=$GAIAMA_CONTENT_TOKEN"
  - mkdir content
  - ls -lah
  - tar -xzf content.tgz -C content
  - ls -lah

script:
  - yarn build

#before_deploy:
#  - yarn build

deploy:
  - provider: script
    script: curl -X POST -d '' "https://api.netlify.com/build_hooks/$NETLIFY_BUILD_HOOK_ID_V2"
    skip_cleanup: true
    on:
      branch: v2
#  - provider: script
#    script: netlify deploy -s master -t $NETLIFY_ACCESS_TOKEN -p ./public
#    skip_cleanup: true
#    on:
#      branch: master
#      tags: true
#  - provider: script
#    script: netlify deploy -s dev -t $NETLIFY_ACCESS_TOKEN -p ./public
#    skip_cleanup: true
#    on:
#      branch: dev
